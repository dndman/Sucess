#!/bin/bash
#ну, дежурное
apt update
apt -y upgrade
apt -y install mc
#создаем пользователя mailuser, пароль 1 (нахуй сесурити)
useradd mailuser -m
echo mailuser:1 | chpasswd
#инсталлим голый exim
apt -y install exim4-daemon-light
#понеслась. первая строка срабатывает нормально, при dpkg-reconfigure компилятор "помнит", что это не
#"локальный(закрытый для сети) сервер, а сетевой(способен принимать почту из сети)
sed -i 's/'local'/'internet'/g' /etc/exim4/update-exim4.conf.conf
#проблема номер первая. по умолчанию слушает 127.0.0.1 и ::1(ipv6)
#в случае, если все оставить по умолчанию, слушать будет только себя. если удалить все значения,
#то exim начинает слушать все доступные интерфейсы. проблема в том, чтобы через sed удалить два двоеточия.
#они считаются командными символами и мне не удалось удалить адрес ipv6. хотя, при реконфигурации 
#установщик считает, что там все удалено.
#имя хоста екзим распознает как домен самостоятельно
sed -i 's/'127.0.0.1'/''/g' /etc/exim4/update-exim4.conf.conf
#следующая заноза - конфиг игнорит приведенные в строке изменения. хоть выебись там mail_spool
#почта приходит не в папку пользователя, а в /var/mail, там заводится файлик с именем
#пользователя, на которого слали почту(при условии, что он есть в системе), и в один файл сыплются
#все поступающие письма
sed -i 's/'mail_spool'/'maildir_home'/g' /etc/exim4/update-exim4.conf.conf
#пусть будет
service exim4 stop
service exim4 start
#сия команда призвана актуализировать текущие настройки конфа
update-exim4.conf
#пусть будет
service exim4 restart





